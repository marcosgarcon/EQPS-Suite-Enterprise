
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EQPS Ultimate 5.0 - Panasonic Extrema</title>
    <meta name="theme-color" content="#020617">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom": "https://esm.sh/react-dom@^19.2.3",
    "react-dom/client": "https://esm.sh/react-dom@^19.2.3/client",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>

    <style>
        :root { --sky-500: #0ea5e9; --bg-dark: #020617; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: #f8fafc; overflow: hidden; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
        .glass-panel { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(16px); border: 1px solid rgba(30, 41, 59, 0.5); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        @media print { .no-print { display: none !important; } body { background: white; color: black; overflow: visible; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            LayoutGrid, ChevronRight, ChevronDown, Folder, Database, Briefcase, Cpu, 
            FileSearch, Box, Binary, Settings, Rocket, Code2, GraduationCap, Activity, 
            FileCheck, Wrench, ShieldCheck, History, ClipboardCheck, Package, Layers, 
            FileText, Search, Sparkles, X, Send, Terminal as TerminalIcon, CheckCircle2,
            UploadCloud, FileDown, PlusCircle, Trash2, Save, Wand2, Dna, Image as ImageIcon,
            FileJson, Loader2, AlertCircle, AlertTriangle, Target, Clock, BookOpen, Award,
            ArrowLeft, Zap, ExternalLink, Monitor, User, Shield, Microscope
        } from 'lucide-react';
        import { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
            AreaChart, Area, Cell, LineChart, Line
        } from 'recharts';
        import { GoogleGenAI, Type } from '@google/genai';

        // --- CONFIGURAÇÕES ---
        const BUSINESS_UNITS = ['WM-Lavadoras', 'RF-Refrigerador', 'Qualidade', 'Manutenção'];
        const MODELS = ['W640', 'W600', 'B41', 'GERAL'];
        const DOC_TYPES = ['FITP', 'Desenhos', 'Cartas de Controle', 'Estoque', 'Checklist'];

        const INITIAL_DB = {
            kpis: {
                FPY: { key: 'FPY', name: 'FPY Global', category: 'Qualidade', target: 98, comparator: '>=', unit: '%' },
                OEE: { key: 'OEE', name: 'OEE Linha 01', category: 'Eficiência', target: 85, comparator: '>=', unit: '%' }
            },
            records: { FPY: [{ id: 1, date: '2024-05-20', value: 97.5 }] },
            courses: [],
            assets: [],
            controlCharts: [] // Armazena inspeções extraídas via IA
        };

        // --- COMPONENTES ---

        // 1. Sidebar
        const Sidebar = ({ onNavigate, currentView }) => {
            return (
                <div className="w-72 h-screen bg-[#020617] border-r border-slate-800/60 flex flex-col z-50 shadow-2xl no-print">
                    <div className="p-8 border-b border-slate-800/40 flex items-center gap-4">
                        <div className="bg-sky-500 p-2 rounded-2xl"><Database className="text-slate-900" size={20} /></div>
                        <div>
                            <h1 className="text-white font-black text-lg tracking-tighter uppercase leading-none">EQPS Suite</h1>
                            <p className="text-[9px] text-slate-600 uppercase font-black tracking-[0.2em]">Enterprise 5.0</p>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                        <nav className="space-y-1">
                            <button onClick={() => onNavigate('dashboard')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-2xl transition-all ${currentView === 'dashboard' ? 'bg-sky-500 text-slate-900 font-black' : 'hover:bg-slate-900 text-slate-400'}`}>
                                <LayoutGrid size={18} /> <span className="text-xs uppercase font-black">Dashboard</span>
                            </button>
                            <button onClick={() => onNavigate('quality-lab')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-2xl transition-all ${currentView === 'quality-lab' ? 'bg-emerald-500 text-slate-900 font-black' : 'hover:bg-slate-900 text-slate-400'}`}>
                                <Microscope size={18} /> <span className="text-xs uppercase font-black">Laboratório CQ</span>
                            </button>
                            <button onClick={() => onNavigate('academy')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-2xl transition-all ${currentView === 'academy' ? 'bg-amber-500 text-slate-900 font-black' : 'hover:bg-slate-900 text-slate-400'}`}>
                                <GraduationCap size={18} /> <span className="text-xs uppercase font-black">Academia</span>
                            </button>
                            <button onClick={() => onNavigate('config')} className={`w-full flex items-center gap-3 px-4 py-3 rounded-2xl transition-all ${currentView === 'config' ? 'bg-indigo-500 text-slate-900 font-black' : 'hover:bg-slate-900 text-slate-400'}`}>
                                <Settings size={18} /> <span className="text-xs uppercase font-black">Data Hub</span>
                            </button>
                        </nav>
                    </div>
                </div>
            );
        };

        // 2. Laboratório de CQ (Extração de Dados de Carta de Controle)
        const QualityLab = ({ onAddInspection }) => {
            const [file, setFile] = useState(null);
            const [base64, setBase64] = useState(null);
            const [loading, setLoading] = useState(false);
            const [points, setPoints] = useState([]);
            const [model, setModel] = useState('');

            const handleFileUpload = (e) => {
                const f = e.target.files[0];
                if (!f) return;
                setFile(f);
                const reader = new FileReader();
                reader.onload = (ev) => setBase64(ev.target.result.split(',')[1]);
                reader.readAsDataURL(f);
            };

            const extractData = async () => {
                if (!base64 || !model) return;
                setLoading(true);
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                try {
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: {
                            parts: [
                                { text: `Analise esta carta de controle industrial para o modelo ${model}. Extraia os pontos de medição em JSON: id (P1, P2...), label (descrição), nominal (número), tolerancePlus (número), toleranceMinus (número).` },
                                { inlineData: { data: base64, mimeType: file.type } }
                            ]
                        },
                        config: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: Type.ARRAY,
                                items: {
                                    type: Type.OBJECT,
                                    properties: {
                                        id: { type: Type.STRING },
                                        label: { type: Type.STRING },
                                        nominal: { type: Type.NUMBER },
                                        tolerancePlus: { type: Type.NUMBER },
                                        toleranceMinus: { type: Type.NUMBER }
                                    }
                                }
                            }
                        }
                    });
                    const data = JSON.parse(response.text);
                    setPoints(data.map(p => ({ ...p, measured: null })));
                } catch (e) { alert("Erro na extração: " + e.message); }
                setLoading(false);
            };

            const checkPoint = (p) => {
                if (p.measured === null || p.measured === undefined) return 'pending';
                const val = parseFloat(p.measured);
                return (val >= p.nominal - p.toleranceMinus && val <= p.nominal + p.tolerancePlus) ? 'pass' : 'fail';
            };

            return (
                <div className="space-y-10 animate-in">
                    <div className="glass-panel p-10 rounded-[3rem] flex flex-col md:flex-row justify-between items-center gap-8">
                        <div className="flex items-center gap-6">
                            <div className="w-16 h-16 bg-emerald-500 rounded-3xl flex items-center justify-center text-slate-900 shadow-xl"><Microscope size={32} /></div>
                            <div>
                                <h2 className="text-3xl font-black text-white uppercase tracking-tight">Laboratório CQ</h2>
                                <p className="text-xs text-slate-500 font-bold uppercase tracking-widest mt-1">Extração de Carta de Controle via IA</p>
                            </div>
                        </div>
                        <div className="flex gap-4">
                            <input value={model} onChange={e => setModel(e.target.value)} placeholder="Modelo (W640, B41...)" className="bg-slate-900 border border-slate-800 rounded-2xl px-6 py-4 text-xs text-white outline-none focus:border-emerald-500 w-48" />
                            <div onClick={() => document.getElementById('cqIn').click()} className="px-8 py-4 bg-slate-900 border border-slate-800 rounded-2xl font-black text-xs uppercase text-slate-400 cursor-pointer hover:text-white flex items-center gap-2">
                                <UploadCloud size={16} /> {file ? file.name : "Selecionar PDF/Foto"}
                            </div>
                            <input id="cqIn" type="file" className="hidden" onChange={handleFileUpload} />
                            <button onClick={extractData} disabled={loading || !file || !model} className="px-8 py-4 bg-emerald-500 text-slate-950 rounded-2xl font-black text-xs uppercase hover:bg-emerald-400 disabled:opacity-20 transition-all flex items-center gap-2">
                                {loading ? <Loader2 className="animate-spin" size={16} /> : <Sparkles size={16} />} Processar IA
                            </button>
                        </div>
                    </div>

                    {points.length > 0 && (
                        <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                            <div className="lg:col-span-8 glass-panel p-10 rounded-[3rem] space-y-8">
                                <h3 className="text-sm font-black uppercase text-slate-500 tracking-widest border-b border-slate-800 pb-4">Checklist de Inspeção Dimensional - {model}</h3>
                                <div className="space-y-4">
                                    {points.map((p, i) => {
                                        const status = checkPoint(p);
                                        return (
                                            <div key={i} className="flex items-center justify-between p-6 bg-slate-900/50 rounded-2xl border border-slate-800">
                                                <div className="flex-1">
                                                    <p className="text-[10px] font-black text-emerald-500 uppercase">{p.id}</p>
                                                    <p className="text-sm font-black text-white uppercase">{p.label}</p>
                                                    <p className="text-[10px] text-slate-500 font-bold">Nominal: {p.nominal}mm (+{p.tolerancePlus} / -{p.toleranceMinus})</p>
                                                </div>
                                                <div className="flex items-center gap-4">
                                                    <input 
                                                        type="number" 
                                                        placeholder="Medido" 
                                                        className="w-24 bg-slate-950 border border-slate-800 rounded-xl px-4 py-3 text-xs text-white outline-none focus:border-emerald-500"
                                                        onChange={(e) => {
                                                            const newPoints = [...points];
                                                            newPoints[i].measured = e.target.value;
                                                            setPoints(newPoints);
                                                        }}
                                                    />
                                                    {status === 'pass' && <CheckCircle2 className="text-emerald-500" size={24} />}
                                                    {status === 'fail' && <AlertCircle className="text-rose-500" size={24} />}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                                <button className="w-full py-5 bg-emerald-500 text-slate-950 rounded-2xl font-black text-xs uppercase tracking-widest hover:bg-emerald-400">Finalizar e Salvar Laudo</button>
                            </div>
                            <div className="lg:col-span-4 glass-panel p-10 rounded-[3rem] flex flex-col items-center justify-center text-center">
                                <Target className="text-emerald-500 mb-6" size={64} />
                                <h4 className="text-4xl font-black text-white">{points.filter(p => checkPoint(p) === 'pass').length}/{points.length}</h4>
                                <p className="text-[10px] font-black uppercase text-slate-500 mt-2">Pontos em Conformidade</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [db, setDb] = useState(() => {
                const saved = localStorage.getItem('eqps-v5-ultimate-db');
                return saved ? JSON.parse(saved) : INITIAL_DB;
            });
            const [view, setView] = useState('dashboard');

            useEffect(() => localStorage.setItem('eqps-v5-ultimate-db', JSON.stringify(db)), [db]);

            return (
                <div className="flex h-screen overflow-hidden">
                    <Sidebar onNavigate={setView} currentView={view} />
                    <div className="flex-1 flex flex-col h-screen overflow-hidden">
                        <header className="h-20 glass-panel border-b border-slate-800 flex items-center justify-between px-10 z-50 shrink-0">
                            <div className="flex items-center gap-6">
                                <ShieldCheck className="text-sky-500" size={24} />
                                <div>
                                    <h1 className="text-[10px] font-black uppercase text-slate-500 tracking-[0.3em]">Status Operacional</h1>
                                    <p className="text-xs font-black text-white uppercase">Planta de Extrema / Hub Digital</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <button onClick={() => setView('dashboard')} className={`p-2.5 rounded-xl ${view === 'dashboard' ? 'bg-sky-500 text-slate-900' : 'bg-slate-900 text-slate-400'}`}><LayoutGrid size={20} /></button>
                                <div className="w-10 h-10 rounded-2xl bg-sky-500 flex items-center justify-center text-[10px] font-black text-slate-950 border border-white/10 shadow-lg">AD</div>
                            </div>
                        </header>
                        <main className="flex-1 overflow-y-auto p-10 custom-scrollbar">
                            <div className="max-w-[1400px] mx-auto pb-40">
                                {view === 'dashboard' && (
                                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 animate-in">
                                        <div className="lg:col-span-2 glass-panel p-10 rounded-[3rem] h-64 flex flex-col justify-between">
                                            <h3 className="text-sm font-black uppercase text-slate-500 tracking-widest">OEE Global</h3>
                                            <div className="flex items-end justify-between">
                                                <span className="text-9xl font-black text-white tracking-tighter">94.1%</span>
                                                <div className="px-6 py-2 bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 rounded-full font-black text-xs uppercase tracking-widest">Estabilidade Industrial</div>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                {view === 'quality-lab' && <QualityLab onAddInspection={(ins) => setDb(prev => ({ ...prev, controlCharts: [...prev.controlCharts, ins] }))} />}
                                {view === 'academy' && <div className="p-20 text-center glass-panel rounded-[3rem] text-slate-500 font-black uppercase tracking-widest">Academia Corporativa Carregando...</div>}
                                {view === 'config' && <div className="p-20 text-center glass-panel rounded-[3rem] text-slate-500 font-black uppercase tracking-widest">Configurações de Data Hub</div>}
                            </div>
                        </main>
                    </div>
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
